# UnPoller Helm Chart values
# Monitors UniFi UDM Pro and USW-Enterprise-24-PoE
# Exports metrics to Prometheus

image:
  repository: ghcr.io/unpoller/unpoller
  pullPolicy: IfNotPresent
  tag: "v2.11.2"

replicaCount: 1

# UnPoller configuration (TOML format)
# Creates a read-only connection to UniFi controller
upConfig: |
  [poller]
  debug = false
  quiet = false
  plugins = []

  [prometheus]
  disable = false
  http_listen = "0.0.0.0:9130"
  report_errors = false

  [influxdb]
  disable = true

  [loki]
  disable = true

  [[unifi.controller]]
  # UDM Pro on VLAN 10
  url = "https://10.20.10.1"
  user = "${UNIFI_USER}"
  pass = "${UNIFI_PASS}"
  sites = ["all"]
  # UDM Pro uses port 443 (UniFiOS)
  verify_ssl = false
  # Save some bandwidth
  save_ids = true
  save_events = false
  save_alarms = false
  save_anomalies = false
  save_dpi = false
  save_sites = true

# Pod resources
resources:
  requests:
    memory: 64Mi
    cpu: 50m
  limits:
    memory: 256Mi
    cpu: 200m

# Run on control plane nodes
nodeSelector:
  node-role.kubernetes.io/control-plane: "true"

tolerations:
  - key: "node-role.kubernetes.io/control-plane"
    operator: "Exists"
    effect: "NoSchedule"

# Service for Prometheus scraping
service:
  type: ClusterIP
  port: 9130

# ServiceMonitor for Prometheus Operator
serviceMonitor:
  enabled: true
  namespace: monitoring
  interval: 30s
  scrapeTimeout: 10s
  additionalLabels:
    release: monitoring

# Grafana dashboards (auto-provisioned)
dashboards:
  enabled: true
  labels:
    grafana_dashboard: "1"
