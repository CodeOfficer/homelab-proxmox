# =============================================================================
# Homelab Proxmox Environment Configuration
# =============================================================================
# Copy this file to .envrc and fill in your values
# Run: direnv allow
#
# IMPORTANT: Never commit .envrc to git! It contains sensitive information.
# =============================================================================

# -----------------------------------------------------------------------------
# Proxmox API Configuration
# -----------------------------------------------------------------------------
# Create API token in Proxmox:
# 1. Go to Datacenter > Permissions > API Tokens
# 2. Create token for user (e.g., root@pam!terraform)
# 3. Set privileges: PVEDatastoreUser, PVEVMAdmin, PVEPoolAdmin
export TF_VAR_proxmox_api_url="https://10.10.10.10:8006/api2/json"
export TF_VAR_proxmox_api_token_id="root@pam!terraform=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
export TF_VAR_proxmox_insecure="true"  # Set to "false" with valid SSL certs
export TF_VAR_proxmox_ssh_user="root"

# -----------------------------------------------------------------------------
# K3s Cluster Configuration
# -----------------------------------------------------------------------------
export TF_VAR_k3s_cluster_name="homelab"
export TF_VAR_k3s_version="v1.28.5+k3s1"
export TF_VAR_k3s_cluster_domain="k3s.home.arpa"

# -----------------------------------------------------------------------------
# VM Template Configuration
# -----------------------------------------------------------------------------
# VM template should be created first using Packer or manually
# See: docs/setup.md for VM template creation instructions
export TF_VAR_vm_template_name="ubuntu-2404-cloud-init"
export TF_VAR_vm_template_vmid="9000"
export TF_VAR_vm_ssh_user="ubuntu"
export TF_VAR_vm_ssh_password="your-secure-password-here"

# SSH public key for VM access (optional, but recommended)
# export TF_VAR_vm_ssh_keys='["ssh-rsa AAAA... user@host"]'

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------
export TF_VAR_dns_servers='["10.10.10.1"]'  # UDM as DNS
export TF_VAR_search_domain="home.arpa"

# -----------------------------------------------------------------------------
# Storage Configuration
# -----------------------------------------------------------------------------
export TF_VAR_storage_pool="local-lvm"

# -----------------------------------------------------------------------------
# K3s Server Nodes (Control Plane)
# -----------------------------------------------------------------------------
# Define 2 control plane nodes on pve-node-02 and pve-node-03
# Using VLAN 20 (Server) from network.md
export TF_VAR_k3s_server_nodes='[
  {
    "name": "k3s-server-01",
    "target_node": "pve-node-02",
    "vmid": 200,
    "ip_address": "10.10.20.10",
    "gateway": "10.10.20.1",
    "cpu_cores": 4,
    "memory": 8192,
    "disk_size": "32G",
    "vlan_tag": 20
  },
  {
    "name": "k3s-server-02",
    "target_node": "pve-node-03",
    "vmid": 201,
    "ip_address": "10.10.20.11",
    "gateway": "10.10.20.1",
    "cpu_cores": 4,
    "memory": 8192,
    "disk_size": "32G",
    "vlan_tag": 20
  }
]'

# -----------------------------------------------------------------------------
# K3s Agent Nodes (Workers)
# -----------------------------------------------------------------------------
# Define 1 worker node on pve-node-01 with GPU passthrough
# Using VLAN 20 (Server) from network.md
export TF_VAR_k3s_agent_nodes='[
  {
    "name": "k3s-agent-01",
    "target_node": "pve-node-01",
    "vmid": 210,
    "ip_address": "10.10.20.20",
    "gateway": "10.10.20.1",
    "cpu_cores": 8,
    "memory": 32768,
    "disk_size": "64G",
    "vlan_tag": 20,
    "gpu_passthrough": true
  }
]'

# -----------------------------------------------------------------------------
# GPU Passthrough Configuration
# -----------------------------------------------------------------------------
# GPU device mapping name configured in Proxmox
# Create mapping: Datacenter > Resource Mappings > PCI Devices
export TF_VAR_gpu_mapping_name="gpu0"

# -----------------------------------------------------------------------------
# Application Secrets (for Kubernetes deployments)
# -----------------------------------------------------------------------------

# PostgreSQL
export POSTGRESQL_PASSWORD="change-me-strong-password"

# Redis
export REDIS_PASSWORD="change-me-strong-password"

# MinIO (S3-compatible object storage)
export MINIO_ROOT_USER="admin"
export MINIO_ROOT_PASSWORD="change-me-strong-password"

# n8n (Workflow Automation)
export N8N_ENCRYPTION_KEY="change-me-32-char-encryption-key"
export N8N_DB_PASSWORD="change-me-strong-password"

# Home Assistant
export HOMEASSISTANT_PASSWORD="change-me-strong-password"

# Grafana
export GRAFANA_ADMIN_PASSWORD="change-me-strong-password"

# -----------------------------------------------------------------------------
# Kubectl Configuration
# -----------------------------------------------------------------------------
# Path to kubeconfig for cluster access
export KUBECONFIG="${PWD}/infrastructure/terraform/kubeconfig"

# -----------------------------------------------------------------------------
# Utility Exports
# -----------------------------------------------------------------------------
# First server IP for direct SSH access
export FIRST_SERVER_IP="10.10.20.10"

# First agent IP for testing
export FIRST_AGENT_IP="10.10.20.20"

# =============================================================================
# End of Configuration
# =============================================================================
